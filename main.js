!function(){"use strict";class e{constructor(e,t,s,r,i){this._cardTitle=e.name,this._cardLink=e.link,this._cardLikes=e.likes,this._id=e._id,this._owner=e.owner,this._userId=e.userId,this._cardSelector=t,this._handleCardClick=s,this._handleCardLikeClick=i,this._cardElement=this._getTemplate(),this._cardImage=this._cardElement.querySelector(".gallery__card-image"),this._cardLikeButton=this._cardElement.querySelector(".gallery__card-button"),this._cardDeleteButton=this._cardElement.querySelector(".gallery__delete-card"),this._cardLikesCounter=this._cardElement.querySelector(".gallery__card-likes-counter"),this._deleteCardConfirmation=r}_setCardLikes(){this._cardLikes&&(this._cardLikesCounter.textContent=this._cardLikes.length),this.hasLikes()?this._cardLikeButton.classList.add("gallery__card-button_active"):this._cardLikeButton.classList.remove("gallery__card-button_active")}_handleLike(e){this._handleCardLikeClick(this._id)}hasLikes(){return!!this._cardLikes&&this._cardLikes.length>0}isLiked(e){return!!this._cardLikes&&this._cardLikes.find((t=>t._id===e))}updateLikes(e){this._cardLikes=e,this._setCardLikes()}_deleteGalleryCard(e){e.target.closest(".gallery__card").remove()}_handleImageClick(){this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._cardLink,this._cardTitle)}))}_handleCardDeleteButton(){this._cardDeleteButton.addEventListener("click",this._deleteCardConfirmation)}_handleCardLikeButton(){this._cardLikeButton.addEventListener("click",(e=>{this._handleLike(e),e.target.classList.toggle("gallery__card-button_active")}))}_setEventListeners(){this._handleImageClick(),this._handleCardDeleteButton(this._id),this._handleCardLikeButton(this._id)}_getTemplate(){return document.querySelector(this._cardSelector).content.cloneNode(!0)}removeCard(){document.getElementById(this._id).closest(".gallery__card").remove()}generateCard(){return this._cardImage.setAttribute("src",this._cardLink),this._cardImage.setAttribute("alt",this._cardTitle),this._cardImage.setAttribute("id",this._id),this._cardElement.querySelector(".gallery__card-title").textContent=this._cardTitle,this._setCardLikes(this._cardLikes),this._setEventListeners(),this._owner._id!==this._userId&&this._cardDeleteButton.remove(),this._cardElement}}class t{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup_active"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_active"),document.removeEventListener("keyup",this._handleEscClose)}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._submitHandler=t,this._form=this._popupElement.querySelector(".form"),this._submitButton=this._form.querySelector("button"),this._inputs=[...this._form.querySelectorAll(".form__input")],this._buttonText=this._submitButton.textContent}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.name,r=t.value;e[s]=r})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault();const t=this._getInputValues();this._submitHandler(t)}))}renderLoading(e){this._submitButton.textContent=e?"Saving...":this._buttonText}close(){super.close(),this._form.reset()}}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e,t){r(this,"_showInputError",((e,t)=>{const s=this._element.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)})),r(this,"_hideInputError",(e=>{const t=this._element.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)})),r(this,"_isValid",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),r(this,"_hasInvalidInput",(e=>e.some((e=>!e.validity.valid)))),r(this,"resetValidation",(()=>{this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))})),r(this,"_toggleButtonState",(()=>{this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled","")):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))})),r(this,"_setEventListeners",(()=>{this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._isValid(e),this._toggleButtonState()}))}))})),r(this,"enableValidation",(()=>{this._element.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()})),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._element=t,this._inputList=Array.from(this._element.querySelectorAll(this._inputSelector)),this._buttonElement=this._element.querySelector(this._submitButtonSelector)}}const n={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"},a=document.querySelector("form[name=avatarProfileForm]"),o=profilePopup.querySelector(".form"),l=newPlacePopup.querySelector(".form"),d=document.getElementById("newPlaceButton"),c=document.querySelector(".profile__open-button"),h=(document.querySelector(".gallery__container"),document.getElementById("name")),_=document.getElementById("job"),u=(document.querySelector(".profile__image_container > img"),document.querySelector(".profile__image_container")),m=t=>{const s=(t=>{t.userId=p.getUserInfo()._id;const s=new e(t,"#galleryCard",((e,t)=>{E.open(e,t)}),(e=>{b.open(),b.setAction((()=>{b.renderLoading(!0),S.deleteCard(s._id).then((()=>{s.removeCard(),b.close()})).catch((e=>{console.log(e)})).finally((()=>{b.renderLoading(!1)}))}))}),(e=>{s.isLiked(p.getUserInfo()._id)?S.removeLikeCard(e).then((e=>{s.updateLikes(e.likes)})).catch((e=>{console.log(e)})):S.addLikeCard(e).then((e=>{s.updateLikes(e.likes)})).catch((e=>{console.log(e)}))}));return s})(t);L.addItem(s.generateCard())},p=new class{constructor(e,t){this._profile=document.querySelector(t),this._profileName=this._profile.querySelector(e.userNameSelector),this._profileJob=this._profile.querySelector(e.userJobSelector),this._profileAvatar=document.querySelector(e.userAvatarSelector),this._profileId=""}getUserInfo(){return{name:this._profileName.textContent,job:this._profileJob.textContent,avatar:this._profileAvatar.src,_id:this._profileId}}setUserInfo(e,t,s){this._profileName.textContent=e,this._profileJob.textContent=t,this._profileId=s}setUserAvatar(e){this._profileAvatar.setAttribute("src",e.avatarLink)}}({userNameSelector:".profile__name",userJobSelector:".profile__description",userAvatarSelector:".profile__image"},".profile__info"),L=new class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._temporaryStorage=[],this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addNewItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._temporaryStorage=[...e],this._temporaryStorage.forEach((e=>{this._renderer(e)})),this._items=[...this._items,...this._temporaryStorage],this._temporaryStorage=[]}addItem(e){this._container.prepend(e)}}({items:[],renderer:m},".gallery__container"),g=new s("#newPlacePopup",(e=>{g.renderLoading(!0),S.addCard({title:e.cardTitle,image:e.cardLink}).then((e=>{m({name:e.name,link:e.link,_id:e._id,owner:e.owner,userId:p.getUserInfo()._id},g.close())})).catch((e=>{console.log(e)})).finally((()=>{g.renderLoading(!1)}))}),n),f=new s("#profilePopup",(e=>{f.renderLoading(!0),S.addUserInfo(e).then((e=>{p.setUserInfo(e.name,e.about,e._id),f.close()})).catch((e=>{console.log(e)})).finally((()=>{f.renderLoading(!1)}))}),n),v=new s("#avatarProfilePopup",(e=>{v.renderLoading(!0),S.addUserAvatar(e).then((()=>{p.setUserAvatar(e),v.close()})).catch((e=>{console.log(e)})).finally((()=>{v.renderLoading(!1)}))}),n),b=new class extends t{constructor(e){super(e),this._form=this._popupElement.querySelector(".form"),this._submitButton=this._form.querySelector("button"),this._buttonText=this._submitButton.textContent}setAction(e){this._handleSubmit=e}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(),super.close()})),super.setEventListeners()}renderLoading(e){this._submitButton.textContent=e?"Deleting...":this._buttonText}}("#deleteCardPopup"),E=new class extends t{open(e,t){super.open();const s=this._popupElement.querySelector("img"),r=this._popupElement.querySelector("p");s.src=e,s.alt=t,r.textContent=t}}("#bigPicturePopup");E.setEventListeners(),g.setEventListeners(),f.setEventListeners(),v.setEventListeners(),b.setEventListeners(),d.addEventListener("click",(()=>{k.resetValidation(),g.open()})),c.addEventListener("click",(()=>{var e;e=p.getUserInfo(),h.value=e.name,_.value=e.job,f.open()})),u.addEventListener("click",(()=>{v.open()}));const C=new i(n,o),k=new i(n,l),y=new i(n,a);C.enableValidation(),k.enableValidation(),y.enableValidation();const S=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getUserInfo(){return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}addUserAvatar(e){return fetch(this._baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatarLink})})}addUserInfo(e){return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.job})}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}getCards(){return fetch(this._baseUrl+"/cards",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}addCard(e){return fetch(this._baseUrl+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e.title,link:e.image})}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}deleteCard(e){return fetch(this._baseUrl+"/cards/"+e,{method:"DELETE",headers:this._headers})}addLikeCard(e){return fetch(this._baseUrl+"/cards/likes/"+e,{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}removeLikeCard(e){return fetch(this._baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{Authorization:"cd2997d4-0d31-42a2-a383-a9a3b826db8e","Content-Type":"application/json"}});Promise.all([S.getUserInfo(),S.getCards()]).then((e=>{let[t,s]=e;const r=t._id,{avatar:i,name:n,about:a}=t,o={avatarLink:i};console.log(t),p.setUserInfo(n,a,r),p.setUserAvatar(o),L.addNewItems(s)})).catch((e=>{console.log(e)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLMk0sU0FBVyxnQkFBa0IvRyxFQUFJLENBQy9Dd0gsT0FBUSxTQUNSVixRQUFTMU0sS0FBSzRNLFdBQ2YvRCxNQUFLTyxHQUFPQSxFQUFJMEQsR0FBSzFELEVBQUkyRCxPQUFTQyxRQUFRQyxPQUFPN0QsRUFBSThELGdCTHdKNUMsQ0FDaEJULFFBQVMsaURBQ1RDLFFBQVMsQ0FDTGUsY0FBZSx1Q0FDZixlQUFnQixzQkFJeEJULFFBQVFVLElBQUksQ0FBQy9FLEVBQUlMLGNBQWVLLEVBQUk2RSxhQUMvQjNFLE1BQUssSUFBMkIsSUFBekJZLEVBQVVrRSxHQUFlLEVBQzdCLE1BQU1oTixFQUFTOEksRUFBU2xKLEtBRWxCLE9BQUU2SixFQUFGLEtBQVVsSyxFQUFWLE1BQWdCeUwsR0FBVWxDLEVBQzFCbUUsRUFBYSxDQUFFakQsV0FBWVAsR0FDakNwQixRQUFRQyxJQUFJUSxHQUNacEIsRUFBU2lDLFlBQVlwSyxFQUFNeUwsRUFBT2hMLEdBQ2xDMEgsRUFBU29DLGNBQWNtRCxHQUV2QnJFLEVBQVE2QixZQUFZdUMsTUFFdkI3RSxPQUFPQyxJQUNKQyxRQUFRQyxJQUFJRixNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9wb3B1cFdpdGhDb25maXJtYXRpb24uanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9hcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ2FyZCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGNhcmRTZWxlY3RvcixcbiAgICAgICAgaGFuZGxlQ2FyZENsaWNrLFxuICAgICAgICBkZWxldGVDYXJkQ29uZmlybWF0aW9uLFxuICAgICAgICBoYW5kbGVDYXJkTGlrZVxuICAgICkge1xuICAgICAgICB0aGlzLl9jYXJkVGl0bGUgPSBkYXRhLm5hbWU7XG4gICAgICAgIHRoaXMuX2NhcmRMaW5rID0gZGF0YS5saW5rO1xuICAgICAgICB0aGlzLl9jYXJkTGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgICAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICAgICAgICB0aGlzLl9vd25lciA9IGRhdGEub3duZXI7XG4gICAgICAgIHRoaXMuX3VzZXJJZCA9IGRhdGEudXNlcklkO1xuICAgICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZExpa2VDbGljayA9IGhhbmRsZUNhcmRMaWtlO1xuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fY2FyZC1pbWFnZVwiKTtcbiAgICAgICAgdGhpcy5fY2FyZExpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgXCIuZ2FsbGVyeV9fY2FyZC1idXR0b25cIlxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9jYXJkRGVsZXRlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIFwiLmdhbGxlcnlfX2RlbGV0ZS1jYXJkXCJcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fY2FyZExpa2VzQ291bnRlciA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBcIi5nYWxsZXJ5X19jYXJkLWxpa2VzLWNvdW50ZXJcIlxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuX2RlbGV0ZUNhcmRDb25maXJtYXRpb24gPSBkZWxldGVDYXJkQ29uZmlybWF0aW9uO1xuICAgIH1cblxuICAgIF9zZXRDYXJkTGlrZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jYXJkTGlrZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhcmRMaWtlc0NvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9jYXJkTGlrZXMubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzTGlrZXMoKSkge1xuICAgICAgICAgICAgdGhpcy5fY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImdhbGxlcnlfX2NhcmQtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJnYWxsZXJ5X19jYXJkLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfaGFuZGxlTGlrZShlKSB7XG5cbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZExpa2VDbGljayh0aGlzLl9pZCk7XG4gICAgfVxuXG4gICAgaGFzTGlrZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jYXJkTGlrZXMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYXJkTGlrZXMubGVuZ3RoID4gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaXNMaWtlZChwcm9maWxlSWQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NhcmRMaWtlcykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhcmRMaWtlcy5maW5kKCh1c2VyKSA9PiB1c2VyLl9pZCA9PT0gcHJvZmlsZUlkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdXBkYXRlTGlrZXMobGlrZXMpIHtcbiAgICAgICAgdGhpcy5fY2FyZExpa2VzID0gbGlrZXM7XG4gICAgICAgIHRoaXMuX3NldENhcmRMaWtlcygpO1xuICAgIH1cblxuICAgIF9kZWxldGVHYWxsZXJ5Q2FyZChlKSB7XG4gICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoXCIuZ2FsbGVyeV9fY2FyZFwiKS5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBfaGFuZGxlSW1hZ2VDbGljaygpIHtcbiAgICAgICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sodGhpcy5fY2FyZExpbmssIHRoaXMuX2NhcmRUaXRsZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9oYW5kbGVDYXJkRGVsZXRlQnV0dG9uKCkge1xuICAgICAgICB0aGlzLl9jYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICBcImNsaWNrXCIsXG4gICAgICAgICAgICB0aGlzLl9kZWxldGVDYXJkQ29uZmlybWF0aW9uXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgX2hhbmRsZUNhcmRMaWtlQnV0dG9uKCkge1xuICAgICAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVMaWtlKGV2ZW50KTtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiZ2FsbGVyeV9fY2FyZC1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2soKTtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZERlbGV0ZUJ1dHRvbih0aGlzLl9pZCk7XG4gICAgICAgIHRoaXMuX2hhbmRsZUNhcmRMaWtlQnV0dG9uKHRoaXMuX2lkKTtcbiAgICB9XG5cbiAgICBfZ2V0VGVtcGxhdGUoKSB7XG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgICAgICAgIC5jb250ZW50LmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgcmVtb3ZlQ2FyZCgpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5faWQpLmNsb3Nlc3QoXCIuZ2FsbGVyeV9fY2FyZFwiKS5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBnZW5lcmF0ZUNhcmQoKSB7XG4gICAgICAgIHRoaXMuX2NhcmRJbWFnZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgdGhpcy5fY2FyZExpbmspO1xuICAgICAgICB0aGlzLl9jYXJkSW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHRoaXMuX2NhcmRUaXRsZSk7XG4gICAgICAgIHRoaXMuX2NhcmRJbWFnZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0aGlzLl9pZCk7XG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fY2FyZC10aXRsZVwiKS50ZXh0Q29udGVudCA9XG4gICAgICAgICAgICB0aGlzLl9jYXJkVGl0bGU7XG4gICAgICAgIHRoaXMuX3NldENhcmRMaWtlcyh0aGlzLl9jYXJkTGlrZXMpO1xuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuXG4gICAgICAgIGlmICh0aGlzLl9vd25lci5faWQgIT09IHRoaXMuX3VzZXJJZCkge1xuICAgICAgICAgICAgdGhpcy5fY2FyZERlbGV0ZUJ1dHRvbi5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IENhcmQgfTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgX2hhbmRsZUVzY0Nsb3NlID0gKGUpID0+IHtcbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgb3BlbigpIHtcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9hY3RpdmVcIik7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgfVxuXG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfYWN0aXZlXCIpO1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICAgIH1cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cFwiKSB8fFxuICAgICAgICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX2Nsb3NlLWJ1dHRvblwiKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvciwgc3VibWl0SGFuZGxlcikge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fc3VibWl0SGFuZGxlciA9IHN1Ym1pdEhhbmRsZXI7XG4gICAgICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b25cIik7XG4gICAgICAgIHRoaXMuX2lucHV0cyA9IFsuLi50aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybV9faW5wdXRcIildO1xuICAgICAgICB0aGlzLl9idXR0b25UZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICAgIH1cblxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0ge307XG5cbiAgICAgICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBpbnB1dC5uYW1lO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBpbnB1dC52YWx1ZTtcblxuICAgICAgICAgICAgdmFsdWVzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc3QgdmFsdWVzRnJvbUZvcm0gPSB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xuXG4gICAgICAgICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyKHZhbHVlc0Zyb21Gb3JtKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICAgICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX2J1dHRvblRleHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgc3VwZXIuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICAgIH1cbn0iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgICAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XG4gICAgICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBmb3JtRWxlbWVudDtcblxuICAgICAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXG4gICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgX3Nob3dJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSA9PiB7XG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICAgICApO1xuXG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XG4gICAgfTtcblxuICAgIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgICAgICk7XG5cbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gICAgfTtcblxuICAgIF9pc1ZhbGlkID0gKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBfaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICAgICAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXNldFZhbGlkYXRpb24gPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG5cbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICAgICAgfSk7XG5cbiAgICB9O1xuXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlID0gKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0TGlzdCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF9zZXRFdmVudExpc3RlbmVycyA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcblxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1ZhbGlkKGlucHV0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZW5hYmxlVmFsaWRhdGlvbiA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIH07XG59XG5cbmV4cG9ydCB7IEZvcm1WYWxpZGF0b3IgfTsiLCJleHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW3tcbiAgICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xha2UtbG91aXNlLmpwZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIkJhbGQgTW91bnRhaW5zXCIsXG4gICAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXG4gICAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvdmFub2lzZS5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJMYWdvIGRpIEJyYWllc1wiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXG4gICAgfSxcbl07XG5cbmV4cG9ydCBjb25zdCBjb25maWd1cmF0aW9ucyA9IHtcbiAgICBmb3JtU2VsZWN0b3I6IFwiLmZvcm1cIixcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5mb3JtX19pbnB1dFwiLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5mb3JtX19idXR0b25cIixcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcImZvcm1fX2J1dHRvbl9kaXNhYmxlZFwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJmb3JtX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gICAgZXJyb3JDbGFzczogXCJmb3JtX19pbnB1dC1lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5leHBvcnQgY29uc3QgYXZhdGFyRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtW25hbWU9YXZhdGFyUHJvZmlsZUZvcm1dXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVQb3B1cEZvcm0gPSBwcm9maWxlUG9wdXAucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuZXhwb3J0IGNvbnN0IG5ld1BsYWNlRm9ybSA9IG5ld1BsYWNlUG9wdXAucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuZXhwb3J0IGNvbnN0IG5ld1BsYWNlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuZXdQbGFjZUJ1dHRvblwiKTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVQb3B1cE9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIFwiLnByb2ZpbGVfX29wZW4tYnV0dG9uXCJcbik7XG5leHBvcnQgY29uc3QgZ2FsbGVyeUNhcmRUZW1wbGF0ZVNlbGVjdG9yID0gXCIjZ2FsbGVyeUNhcmRcIjtcbmV4cG9ydCBjb25zdCBjYXJkc1dyYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2NvbnRhaW5lclwiKTtcblxuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmFtZVwiKTtcbmV4cG9ydCBjb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiam9iXCIpO1xuXG5cbmV4cG9ydCBjb25zdCBwcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19pbWFnZV9jb250YWluZXIgPiBpbWdcIik7XG5cbmV4cG9ydCBjb25zdCBwcm9maWxlQXZhdGFyT3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VfY29udGFpbmVyXCIpIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5cbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvYXBpXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL3BvcHVwV2l0aENvbmZpcm1hdGlvblwiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvclwiO1xuaW1wb3J0IHsgUG9wdXBXaXRoSW1hZ2UgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZVwiO1xuaW1wb3J0IHtcbiAgICBjb25maWd1cmF0aW9ucyxcbiAgICBuZXdQbGFjZUJ1dHRvbixcbiAgICBwcm9maWxlUG9wdXBPcGVuQnV0dG9uLFxuICAgIGdhbGxlcnlDYXJkVGVtcGxhdGVTZWxlY3RvcixcbiAgICBjYXJkc1dyYXAsXG4gICAgbmFtZUlucHV0LFxuICAgIGpvYklucHV0LFxuICAgIHByb2ZpbGVQb3B1cEZvcm0sXG4gICAgbmV3UGxhY2VGb3JtLFxuICAgIHByb2ZpbGVBdmF0YXJPcGVuQnV0dG9uLFxuICAgIGF2YXRhckZvcm0sXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxuY29uc3QgY3JlYXRlQ2FyZCA9IChjYXJkRGF0YSkgPT4ge1xuICAgIGNhcmREYXRhLnVzZXJJZCA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKClbXCJfaWRcIl07XG4gICAgY29uc3QgX2NhcmQgPSBuZXcgQ2FyZChcbiAgICAgICAgY2FyZERhdGEsXG4gICAgICAgIGdhbGxlcnlDYXJkVGVtcGxhdGVTZWxlY3RvcixcbiAgICAgICAgKGxpbmssIG5hbWUpID0+IHtcbiAgICAgICAgICAgIGJpZ1BpY3R1cmVQb3B1cC5vcGVuKGxpbmssIG5hbWUpO1xuICAgICAgICB9LFxuICAgICAgICAoZSkgPT4ge1xuICAgICAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLm9wZW4oKTtcblxuICAgICAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLnNldEFjdGlvbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gICAgICAgICAgICAgICAgYXBpXG4gICAgICAgICAgICAgICAgICAgIC5kZWxldGVDYXJkKF9jYXJkLl9pZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2NhcmQucmVtb3ZlQ2FyZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDYXJkUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIChpZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYWxyZWFkeUxpa2VkID0gX2NhcmQuaXNMaWtlZCh1c2VySW5mby5nZXRVc2VySW5mbygpW1wiX2lkXCJdKTtcblxuICAgICAgICAgICAgaWYgKGFscmVhZHlMaWtlZCkge1xuICAgICAgICAgICAgICAgIGFwaVxuICAgICAgICAgICAgICAgICAgICAucmVtb3ZlTGlrZUNhcmQoaWQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jYXJkLnVwZGF0ZUxpa2VzKHJlcy5saWtlcyk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYXBpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRMaWtlQ2FyZChpZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2NhcmQudXBkYXRlTGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gX2NhcmQ7XG59O1xuXG5jb25zdCByZW5kZXJDYXJkID0gKGNhcmREYXRhKSA9PiB7XG4gICAgY29uc3QgY2FyZCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xuXG4gICAgc2VjdGlvbi5hZGRJdGVtKGNhcmQuZ2VuZXJhdGVDYXJkKCkpO1xufTtcblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICAgICAgICB1c2VyTmFtZVNlbGVjdG9yOiBcIi5wcm9maWxlX19uYW1lXCIsXG4gICAgICAgIHVzZXJKb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbiAgICAgICAgdXNlckF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19pbWFnZVwiLFxuICAgIH0sXG4gICAgXCIucHJvZmlsZV9faW5mb1wiXG4pO1xuXG5jb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oe1xuICAgICAgICBpdGVtczogW10sXG4gICAgICAgIHJlbmRlcmVyOiByZW5kZXJDYXJkLFxuICAgIH0sXG4gICAgXCIuZ2FsbGVyeV9fY29udGFpbmVyXCJcbik7XG5cbmNvbnN0IGhhbmRsZU5ld1BsYWNlRm9ybVN1Ym1pdCA9IChkYXRhKSA9PiB7XG4gICAgbmV3UGxhY2VQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICAgIGFwaVxuICAgICAgICAuYWRkQ2FyZCh7XG4gICAgICAgICAgICB0aXRsZTogZGF0YVtcImNhcmRUaXRsZVwiXSxcbiAgICAgICAgICAgIGltYWdlOiBkYXRhW1wiY2FyZExpbmtcIl0sXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgIHJlbmRlckNhcmQoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiByZXNbXCJuYW1lXCJdLFxuICAgICAgICAgICAgICAgICAgICBsaW5rOiByZXNbXCJsaW5rXCJdLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IHJlc1tcIl9pZFwiXSxcbiAgICAgICAgICAgICAgICAgICAgb3duZXI6IHJlc1tcIm93bmVyXCJdLFxuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJbmZvLmdldFVzZXJJbmZvKClbXCJfaWRcIl0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYXJkc1dyYXAsXG4gICAgICAgICAgICAgICAgbmV3UGxhY2VQb3B1cC5jbG9zZSgpXG4gICAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgbmV3UGxhY2VQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgfSk7XG59O1xuXG5jb25zdCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCA9IChkYXRhKSA9PiB7XG4gICAgcHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gICAgYXBpXG4gICAgICAgIC5hZGRVc2VySW5mbyhkYXRhKVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICB1c2VySW5mby5zZXRVc2VySW5mbyhyZXMubmFtZSwgcmVzLmFib3V0LCByZXMuX2lkKTtcbiAgICAgICAgICAgIHByb2ZpbGVQb3B1cC5jbG9zZSgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgcHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgICAgICB9KTtcbn07XG5cbmNvbnN0IHN1Ym1pdEF2YXRhciA9IChhdmF0YXJMaW5rKSA9PiB7XG4gICAgYXZhdGFyUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgICBhcGlcbiAgICAgICAgLmFkZFVzZXJBdmF0YXIoYXZhdGFyTGluaylcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdXNlckluZm8uc2V0VXNlckF2YXRhcihhdmF0YXJMaW5rKTtcbiAgICAgICAgICAgIGF2YXRhclBvcHVwLmNsb3NlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KVxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICBhdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgfSk7XG59O1xuXG5jb25zdCBuZXdQbGFjZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gICAgXCIjbmV3UGxhY2VQb3B1cFwiLFxuICAgIGhhbmRsZU5ld1BsYWNlRm9ybVN1Ym1pdCxcbiAgICBjb25maWd1cmF0aW9uc1xuKTtcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICAgIFwiI3Byb2ZpbGVQb3B1cFwiLFxuICAgIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0LFxuICAgIGNvbmZpZ3VyYXRpb25zXG4pO1xuXG5jb25zdCBhdmF0YXJQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICAgIFwiI2F2YXRhclByb2ZpbGVQb3B1cFwiLFxuICAgIHN1Ym1pdEF2YXRhcixcbiAgICBjb25maWd1cmF0aW9uc1xuKTtcblxuY29uc3QgZGVsZXRlQ2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihcIiNkZWxldGVDYXJkUG9wdXBcIik7XG5cbmNvbnN0IGJpZ1BpY3R1cmVQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNiaWdQaWN0dXJlUG9wdXBcIik7XG5cbmJpZ1BpY3R1cmVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xubmV3UGxhY2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xucHJvZmlsZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hdmF0YXJQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuZGVsZXRlQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmZ1bmN0aW9uIGZpbGxQcm9maWxlSW5wdXRzKGluZm8pIHtcbiAgICBuYW1lSW5wdXQudmFsdWUgPSBpbmZvLm5hbWU7XG4gICAgam9iSW5wdXQudmFsdWUgPSBpbmZvLmpvYjtcbn1cblxubmV3UGxhY2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBuZXdQbGFjZUZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgbmV3UGxhY2VQb3B1cC5vcGVuKCk7XG59KTtcblxucHJvZmlsZVBvcHVwT3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZvcm1JbnB1dHMgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuXG4gICAgZmlsbFByb2ZpbGVJbnB1dHMoZm9ybUlucHV0cyk7XG5cbiAgICBwcm9maWxlUG9wdXAub3BlbigpO1xufSk7XG5cbnByb2ZpbGVBdmF0YXJPcGVuQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgYXZhdGFyUG9wdXAub3BlbigpO1xufSk7XG5cbmNvbnN0IHByb2ZpbGVGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gICAgY29uZmlndXJhdGlvbnMsXG4gICAgcHJvZmlsZVBvcHVwRm9ybVxuKTtcbmNvbnN0IG5ld1BsYWNlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZ3VyYXRpb25zLCBuZXdQbGFjZUZvcm0pO1xuY29uc3QgYXZhdGFyRm9ybVByb2ZpbGVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcbiAgICBjb25maWd1cmF0aW9ucyxcbiAgICBhdmF0YXJGb3JtXG4pO1xuXG5wcm9maWxlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5uZXdQbGFjZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuYXZhdGFyRm9ybVByb2ZpbGVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW5cIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IFwiY2QyOTk3ZDQtMGQzMS00MmEyLWEzODMtYTlhM2I4MjZkYjhlXCIsXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH0sXG59KTtcblxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0Q2FyZHMoKV0pXG4gICAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZHNEYXRhXSkgPT4ge1xuICAgICAgICBjb25zdCB1c2VySWQgPSB1c2VyRGF0YS5faWQ7XG4gICAgICAgIC8vIFVzZXJcbiAgICAgICAgY29uc3QgeyBhdmF0YXIsIG5hbWUsIGFib3V0IH0gPSB1c2VyRGF0YTtcbiAgICAgICAgY29uc3QgX25ld0F2YXRhciA9IHsgYXZhdGFyTGluazogYXZhdGFyIH07XG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXJEYXRhKTtcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8obmFtZSwgYWJvdXQsIHVzZXJJZCk7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoX25ld0F2YXRhcik7XG5cbiAgICAgICAgc2VjdGlvbi5hZGROZXdJdGVtcyhjYXJkc0RhdGEpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gICAgY29uc3RydWN0b3IodXNlckRhdGEsIHByb2ZpbGVTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9wcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwcm9maWxlU2VsZWN0b3IpO1xuXG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gdGhpcy5fcHJvZmlsZS5xdWVyeVNlbGVjdG9yKHVzZXJEYXRhLnVzZXJOYW1lU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9wcm9maWxlSm9iID0gdGhpcy5fcHJvZmlsZS5xdWVyeVNlbGVjdG9yKHVzZXJEYXRhLnVzZXJKb2JTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJEYXRhLnVzZXJBdmF0YXJTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVJZCA9IFwiXCJcbiAgICB9XG5cbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgICAgICAgam9iOiB0aGlzLl9wcm9maWxlSm9iLnRleHRDb250ZW50LFxuICAgICAgICAgICAgYXZhdGFyOiB0aGlzLl9wcm9maWxlQXZhdGFyLnNyYyxcbiAgICAgICAgICAgIF9pZDogdGhpcy5fcHJvZmlsZUlkXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0VXNlckluZm8odXNlck5hbWUsIHVzZXJKb2IsIHVzZXJJZCkge1xuICAgICAgICB0aGlzLl9wcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJOYW1lO1xuICAgICAgICB0aGlzLl9wcm9maWxlSm9iLnRleHRDb250ZW50ID0gdXNlckpvYjtcbiAgICAgICAgdGhpcy5fcHJvZmlsZUlkID0gdXNlcklkXG4gICAgfVxuXG4gICAgc2V0VXNlckF2YXRhcih1c2VyQXZhdGFyKSB7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVBdmF0YXIuc2V0QXR0cmlidXRlKFwic3JjXCIsIHVzZXJBdmF0YXIuYXZhdGFyTGluayk7XG4gICAgfVxufSIsImNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgICAgIHRoaXMuX3RlbXBvcmFyeVN0b3JhZ2UgPSBbXTtcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgcmVuZGVySXRlbXMoKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhZGROZXdJdGVtcyhpdGVtcyA9IFtdKSB7XG4gICAgICAgIHRoaXMuX3RlbXBvcmFyeVN0b3JhZ2UgPSBbLi4uaXRlbXNdO1xuXG4gICAgICAgIHRoaXMuX3RlbXBvcmFyeVN0b3JhZ2UuZm9yRWFjaCgoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9pdGVtcyA9IFsuLi50aGlzLl9pdGVtcywgLi4udGhpcy5fdGVtcG9yYXJ5U3RvcmFnZV07XG4gICAgICAgIHRoaXMuX3RlbXBvcmFyeVN0b3JhZ2UgPSBbXTtcbiAgICB9XG5cbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTZWN0aW9uOyIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gZXh0ZW5kcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihcImJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy5fYnV0dG9uVGV4dCA9IHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcbiAgICB9XG5cbiAgICBzZXRBY3Rpb24oYWN0aW9uKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCA9IGFjdGlvbjtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlU3VibWl0KCk7XG4gICAgICAgICAgICBzdXBlci5jbG9zZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKSB7XG4gICAgICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX2J1dHRvblRleHQ7XG4gICAgICAgIH1cbiAgICB9XG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgICBvcGVuKGxpbmssIG5hbWUpIHtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuXG4gICAgICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaW1nXCIpO1xuICAgICAgICBjb25zdCBjYXB0aW9uRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwicFwiKTtcblxuICAgICAgICBpbWFnZUVsZW1lbnQuc3JjID0gbGluaztcbiAgICAgICAgaW1hZ2VFbGVtZW50LmFsdCA9IG5hbWU7XG4gICAgICAgIGNhcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgICAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gICAgfVxuXG4gICAgZ2V0VXNlckluZm8oKSB7XG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9iYXNlVXJsICsgJy91c2Vycy9tZScsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSlcbiAgICB9XG5cblxuICAgIGFkZFVzZXJBdmF0YXIoaW5wdXRWYWx1ZXMpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL3VzZXJzL21lL2F2YXRhcicsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGlucHV0VmFsdWVzLmF2YXRhckxpbmssXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYWRkVXNlckluZm8oaW5wdXRWYWx1ZXMpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL3VzZXJzL21lJywge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIG5hbWU6IGlucHV0VmFsdWVzLm5hbWUsXG4gICAgICAgICAgICAgICAgYWJvdXQ6IGlucHV0VmFsdWVzLmpvYixcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9KS50aGVuKHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxuICAgIH1cblxuICAgIGdldENhcmRzKCkge1xuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArICcvY2FyZHMnLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpXG4gICAgfVxuXG4gICAgYWRkQ2FyZChpbnB1dFZhbHVlcykge1xuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArICcvY2FyZHMnLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBuYW1lOiBpbnB1dFZhbHVlcy50aXRsZSxcbiAgICAgICAgICAgICAgICBsaW5rOiBpbnB1dFZhbHVlcy5pbWFnZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9KS50aGVuKHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxuICAgIH1cblxuICAgIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL2NhcmRzLycgKyBpZCwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYWRkTGlrZUNhcmQoaWQpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL2NhcmRzL2xpa2VzLycgKyBpZCwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSlcbiAgICB9XG5cbiAgICByZW1vdmVMaWtlQ2FyZChpZCkge1xuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArICcvY2FyZHMvbGlrZXMvJyArIGlkLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICB9KS50aGVuKHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxuICAgIH1cblxufSJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiZGVsZXRlQ2FyZENvbmZpcm1hdGlvbiIsImhhbmRsZUNhcmRMaWtlIiwidGhpcyIsIl9jYXJkVGl0bGUiLCJuYW1lIiwiX2NhcmRMaW5rIiwibGluayIsIl9jYXJkTGlrZXMiLCJsaWtlcyIsIl9pZCIsIl9vd25lciIsIm93bmVyIiwiX3VzZXJJZCIsInVzZXJJZCIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZUNhcmRMaWtlQ2xpY2siLCJfY2FyZEVsZW1lbnQiLCJfZ2V0VGVtcGxhdGUiLCJfY2FyZEltYWdlIiwicXVlcnlTZWxlY3RvciIsIl9jYXJkTGlrZUJ1dHRvbiIsIl9jYXJkRGVsZXRlQnV0dG9uIiwiX2NhcmRMaWtlc0NvdW50ZXIiLCJfZGVsZXRlQ2FyZENvbmZpcm1hdGlvbiIsIl9zZXRDYXJkTGlrZXMiLCJ0ZXh0Q29udGVudCIsImxlbmd0aCIsImhhc0xpa2VzIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiX2hhbmRsZUxpa2UiLCJlIiwiaXNMaWtlZCIsInByb2ZpbGVJZCIsImZpbmQiLCJ1c2VyIiwidXBkYXRlTGlrZXMiLCJfZGVsZXRlR2FsbGVyeUNhcmQiLCJ0YXJnZXQiLCJjbG9zZXN0IiwiX2hhbmRsZUltYWdlQ2xpY2siLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUNhcmREZWxldGVCdXR0b24iLCJfaGFuZGxlQ2FyZExpa2VCdXR0b24iLCJldmVudCIsInRvZ2dsZSIsIl9zZXRFdmVudExpc3RlbmVycyIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsInJlbW92ZUNhcmQiLCJnZXRFbGVtZW50QnlJZCIsImdlbmVyYXRlQ2FyZCIsInNldEF0dHJpYnV0ZSIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImtleSIsImNsb3NlIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJvcGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwiZXZ0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwic3VibWl0SGFuZGxlciIsInN1cGVyIiwiX3N1Ym1pdEhhbmRsZXIiLCJfZm9ybSIsIl9zdWJtaXRCdXR0b24iLCJfaW5wdXRzIiwicXVlcnlTZWxlY3RvckFsbCIsIl9idXR0b25UZXh0IiwiX2dldElucHV0VmFsdWVzIiwidmFsdWVzIiwiZm9yRWFjaCIsImlucHV0IiwidmFsdWUiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlc0Zyb21Gb3JtIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsInJlc2V0IiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJfZWxlbWVudCIsImlkIiwiX2lucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oaWRlSW5wdXRFcnJvciIsIl9zaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiaW5wdXRMaXN0Iiwic29tZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9pbnB1dExpc3QiLCJfaGFzSW52YWxpZElucHV0IiwiX2J1dHRvbkVsZW1lbnQiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsInJlbW92ZUF0dHJpYnV0ZSIsIl9pc1ZhbGlkIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIkFycmF5IiwiZnJvbSIsImNvbmZpZ3VyYXRpb25zIiwiZm9ybVNlbGVjdG9yIiwiYXZhdGFyRm9ybSIsInByb2ZpbGVQb3B1cEZvcm0iLCJwcm9maWxlUG9wdXAiLCJuZXdQbGFjZUZvcm0iLCJuZXdQbGFjZVBvcHVwIiwibmV3UGxhY2VCdXR0b24iLCJwcm9maWxlUG9wdXBPcGVuQnV0dG9uIiwibmFtZUlucHV0Iiwiam9iSW5wdXQiLCJwcm9maWxlQXZhdGFyT3BlbkJ1dHRvbiIsInJlbmRlckNhcmQiLCJjYXJkRGF0YSIsImNhcmQiLCJ1c2VySW5mbyIsImdldFVzZXJJbmZvIiwiX2NhcmQiLCJiaWdQaWN0dXJlUG9wdXAiLCJkZWxldGVDYXJkUG9wdXAiLCJzZXRBY3Rpb24iLCJhcGkiLCJkZWxldGVDYXJkIiwidGhlbiIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImZpbmFsbHkiLCJyZW1vdmVMaWtlQ2FyZCIsInJlcyIsImFkZExpa2VDYXJkIiwiY3JlYXRlQ2FyZCIsInNlY3Rpb24iLCJhZGRJdGVtIiwidXNlckRhdGEiLCJwcm9maWxlU2VsZWN0b3IiLCJfcHJvZmlsZSIsIl9wcm9maWxlTmFtZSIsInVzZXJOYW1lU2VsZWN0b3IiLCJfcHJvZmlsZUpvYiIsInVzZXJKb2JTZWxlY3RvciIsIl9wcm9maWxlQXZhdGFyIiwidXNlckF2YXRhclNlbGVjdG9yIiwiX3Byb2ZpbGVJZCIsImpvYiIsImF2YXRhciIsInNyYyIsInNldFVzZXJJbmZvIiwidXNlck5hbWUiLCJ1c2VySm9iIiwic2V0VXNlckF2YXRhciIsInVzZXJBdmF0YXIiLCJhdmF0YXJMaW5rIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3RlbXBvcmFyeVN0b3JhZ2UiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJhZGROZXdJdGVtcyIsImVsZW1lbnQiLCJwcmVwZW5kIiwiYWRkQ2FyZCIsInRpdGxlIiwiaW1hZ2UiLCJhZGRVc2VySW5mbyIsImFib3V0IiwiYXZhdGFyUG9wdXAiLCJhZGRVc2VyQXZhdGFyIiwiYWN0aW9uIiwiX2hhbmRsZVN1Ym1pdCIsImltYWdlRWxlbWVudCIsImNhcHRpb25FbGVtZW50IiwiYWx0IiwibmV3UGxhY2VGb3JtVmFsaWRhdG9yIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5mbyIsInByb2ZpbGVGb3JtVmFsaWRhdG9yIiwiYXZhdGFyRm9ybVByb2ZpbGVWYWxpZGF0b3IiLCJlbmFibGVWYWxpZGF0aW9uIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZmV0Y2giLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzVGV4dCIsImlucHV0VmFsdWVzIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDYXJkcyIsIkF1dGhvcml6YXRpb24iLCJhbGwiLCJjYXJkc0RhdGEiLCJfbmV3QXZhdGFyIl0sInNvdXJjZVJvb3QiOiIifQ==